<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoCompute AI - Training Cost Calculator</title>
    <meta name="description" content="Estimate AI training costs and carbon footprint before you train. Free, instant, accurate.">
    <link rel="icon" href="https://raw.githubusercontent.com/hongping-zh/ecocompute-ai/main/assets/logo-simple.svg" type="image/svg+xml">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        slate: {
                            700: '#334155',
                            800: '#1e293b',
                        }
                    }
                }
            }
        }
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            min-height: 100vh;
            color: white;
        }
        .green-glow { box-shadow: 0 0 30px rgba(34, 197, 94, 0.3); }
    </style>
</head>
<body class="gradient-bg min-h-screen text-white">
    <!-- Header -->
    <header class="py-6 px-4">
        <div class="max-w-4xl mx-auto flex items-center justify-between">
            <div class="flex items-center gap-3">
                <img src="https://raw.githubusercontent.com/hongping-zh/ecocompute-ai/main/assets/logo-simple.svg" alt="EcoCompute AI" class="w-10 h-10">
                <span class="text-xl font-bold text-green-400">EcoCompute AI</span>
            </div>
            <a href="https://github.com/hongping-zh/ecocompute-ai" 
               class="text-gray-400 hover:text-white transition">
                ‚≠ê Star on GitHub
            </a>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-4xl mx-auto px-4 py-8">
        <div class="text-center mb-12">
            <h1 class="text-4xl font-bold mb-4">
                üåø AI Training Cost Calculator
            </h1>
            <p class="text-gray-400 text-lg">
                Estimate costs and carbon footprint <strong class="text-green-400">before</strong> you train
            </p>
        </div>

        <!-- Calculator Card -->
        <div class="bg-slate-800/50 rounded-2xl p-8 green-glow">
            <div class="grid md:grid-cols-2 gap-8">
                <!-- Input Section -->
                <div class="space-y-6">
                    <h2 class="text-xl font-semibold text-green-400 mb-4">üìä Model Configuration</h2>
                    
                    <!-- Model Type -->
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">Model Architecture</label>
                        <select id="modelType" class="w-full bg-slate-700 rounded-lg px-4 py-3 text-white focus:ring-2 focus:ring-green-500 outline-none">
                            <option value="transformer-small">Transformer Small (125M params)</option>
                            <option value="transformer-medium">Transformer Medium (350M params)</option>
                            <option value="transformer-large" selected>Transformer Large (1.3B params)</option>
                            <option value="transformer-xl">Transformer XL (6.7B params)</option>
                            <option value="llama-7b">LLaMA-style 7B</option>
                            <option value="llama-13b">LLaMA-style 13B</option>
                            <option value="llama-70b">LLaMA-style 70B</option>
                            <option value="resnet-50">ResNet-50 (CNN)</option>
                            <option value="resnet-152">ResNet-152 (CNN)</option>
                            <option value="bert-base">BERT Base</option>
                            <option value="bert-large">BERT Large</option>
                        </select>
                    </div>

                    <!-- GPU Type -->
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">GPU Type</label>
                        <select id="gpuType" class="w-full bg-slate-700 rounded-lg px-4 py-3 text-white focus:ring-2 focus:ring-green-500 outline-none">
                            <option value="h100">NVIDIA H100 SXM ($3.50/hr)</option>
                            <option value="a100" selected>NVIDIA A100 80GB ($2.50/hr)</option>
                            <option value="v100">NVIDIA V100 32GB ($1.50/hr)</option>
                            <option value="t4">NVIDIA T4 ($0.50/hr)</option>
                            <option value="l4">NVIDIA L4 ($0.80/hr)</option>
                        </select>
                    </div>

                    <!-- Number of GPUs -->
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">Number of GPUs</label>
                        <input type="range" id="numGpus" min="1" max="64" value="8" 
                               class="w-full accent-green-500">
                        <div class="flex justify-between text-sm text-gray-500 mt-1">
                            <span>1</span>
                            <span id="numGpusValue" class="text-green-400 font-semibold">8</span>
                            <span>64</span>
                        </div>
                    </div>

                    <!-- Training Tokens -->
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">Training Tokens (Billions)</label>
                        <input type="range" id="tokens" min="1" max="2000" value="100" 
                               class="w-full accent-green-500">
                        <div class="flex justify-between text-sm text-gray-500 mt-1">
                            <span>1B</span>
                            <span id="tokensValue" class="text-green-400 font-semibold">100B</span>
                            <span>2T</span>
                        </div>
                    </div>

                    <!-- Region -->
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">Cloud Region</label>
                        <select id="region" class="w-full bg-slate-700 rounded-lg px-4 py-3 text-white focus:ring-2 focus:ring-green-500 outline-none">
                            <option value="us-west">US West (350 gCO‚ÇÇ/kWh)</option>
                            <option value="us-east" selected>US East (400 gCO‚ÇÇ/kWh)</option>
                            <option value="eu-west">EU West (300 gCO‚ÇÇ/kWh)</option>
                            <option value="eu-north">EU North - Sweden (20 gCO‚ÇÇ/kWh)</option>
                            <option value="asia-east">Asia East (550 gCO‚ÇÇ/kWh)</option>
                        </select>
                    </div>
                </div>

                <!-- Results Section -->
                <div class="space-y-6">
                    <h2 class="text-xl font-semibold text-green-400 mb-4">üí∞ Estimated Results</h2>
                    
                    <!-- Cost Card -->
                    <div class="bg-slate-700/50 rounded-xl p-6">
                        <div class="text-sm text-gray-400 mb-1">Estimated Cost</div>
                        <div class="text-4xl font-bold text-white" id="costResult">$12,500</div>
                        <div class="text-sm text-gray-500 mt-1" id="costBreakdown">50 hours √ó 8 GPUs √ó $2.50/hr</div>
                    </div>

                    <!-- Time Card -->
                    <div class="bg-slate-700/50 rounded-xl p-6">
                        <div class="text-sm text-gray-400 mb-1">Training Time</div>
                        <div class="text-3xl font-bold text-white" id="timeResult">50 hours</div>
                        <div class="text-sm text-gray-500 mt-1" id="timeBreakdown">~2.1 days</div>
                    </div>

                    <!-- Carbon Card -->
                    <div class="bg-slate-700/50 rounded-xl p-6">
                        <div class="text-sm text-gray-400 mb-1">Carbon Footprint</div>
                        <div class="text-3xl font-bold text-green-400" id="carbonResult">320 kg CO‚ÇÇe</div>
                        <div class="text-sm text-gray-500 mt-1" id="carbonBreakdown">‚âà 2,080 km driven</div>
                    </div>

                    <!-- Optimization Tips -->
                    <div class="bg-green-900/30 border border-green-700 rounded-xl p-4">
                        <div class="text-sm font-semibold text-green-400 mb-2">üí° Optimization Tip</div>
                        <p class="text-sm text-gray-300" id="optimizationTip">
                            Using mixed precision (FP16/BF16) could reduce training time by 30-50%.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- MLPerf Accuracy Badge -->
        <div class="mt-8 text-center">
            <div class="inline-flex items-center gap-2 bg-slate-800/50 rounded-full px-4 py-2 text-sm text-gray-400">
                <span class="text-green-400">‚úì</span>
                Calibrated on MLPerf benchmarks ‚Ä¢ 
                <a href="../HARDWARE_GROUNDING.md" class="text-green-400 hover:underline">&lt;5% error margin</a>
            </div>
        </div>

        <!-- AI FinOps Advisor Section -->
        <div class="mt-12 bg-gradient-to-r from-purple-900/30 to-blue-900/30 border border-purple-500/30 rounded-2xl p-6 green-glow">
            <div class="flex flex-col md:flex-row items-start md:items-center justify-between gap-4">
                <div class="flex items-center gap-4">
                    <div class="w-14 h-14 bg-purple-500/20 rounded-xl flex items-center justify-center border border-purple-500/30">
                        <span class="text-2xl">ü§ñ</span>
                    </div>
                    <div>
                        <h3 class="text-lg font-bold text-white flex items-center gap-2">
                            AI FinOps Advisor
                            <span class="bg-purple-500 text-white text-[10px] px-2 py-0.5 rounded-full font-bold">BETA</span>
                        </h3>
                        <p class="text-sm text-gray-400">Ask questions about cost optimization, architecture, and ROI</p>
                    </div>
                </div>
                <button onclick="openAdvisorChat()" 
                        class="inline-flex items-center gap-2 bg-purple-600 hover:bg-purple-500 text-white font-semibold px-6 py-3 rounded-lg transition shadow-lg shadow-purple-900/30">
                    üí¨ Start Consultation
                </button>
            </div>
            
            <!-- Quick Questions -->
            <div class="mt-4 flex flex-wrap gap-2">
                <button onclick="askQuickQuestion('roi')" class="text-xs bg-slate-700/50 hover:bg-slate-600 text-gray-300 px-3 py-1.5 rounded-full border border-slate-600 transition">
                    üí∞ How to reduce costs?
                </button>
                <button onclick="askQuickQuestion('architecture')" class="text-xs bg-slate-700/50 hover:bg-slate-600 text-gray-300 px-3 py-1.5 rounded-full border border-slate-600 transition">
                    üèóÔ∏è Architecture best practices
                </button>
                <button onclick="askQuickQuestion('carbon')" class="text-xs bg-slate-700/50 hover:bg-slate-600 text-gray-300 px-3 py-1.5 rounded-full border border-slate-600 transition">
                    üå± Carbon reduction tips
                </button>
            </div>
        </div>

        <!-- CTA -->
        <div class="mt-12 text-center">
            <p class="text-gray-400 mb-4">Want automated cost checks in your CI/CD pipeline?</p>
            <div class="flex flex-wrap justify-center gap-4">
                <a href="https://github.com/hongping-zh/ecocompute-ai" 
                   class="inline-flex items-center gap-2 bg-green-600 hover:bg-green-500 text-white font-semibold px-6 py-3 rounded-lg transition">
                    üöÄ Try GitHub Action
                </a>
                <button onclick="openCiteModal()" 
                        class="inline-flex items-center gap-2 bg-slate-700 hover:bg-slate-600 text-white font-semibold px-6 py-3 rounded-lg transition border border-slate-600">
                    üìö Cite This Tool
                </button>
            </div>
        </div>
    </main>

    <!-- AI FinOps Advisor Modal -->
    <div id="advisorModal" class="fixed inset-0 bg-black/80 hidden items-center justify-center z-50 p-4">
        <div class="bg-slate-900 border border-purple-500/30 w-full max-w-4xl h-[80vh] rounded-2xl shadow-2xl flex overflow-hidden">
            
            <!-- Sidebar -->
            <div class="hidden md:flex w-64 bg-slate-950 border-r border-slate-700 p-6 flex-col justify-between">
                <div>
                    <div class="flex items-center gap-2 mb-6">
                        <span class="text-2xl">ü§ñ</span>
                        <h2 class="font-bold text-white tracking-tight">AI Advisor</h2>
                    </div>
                    
                    <div class="space-y-4">
                        <div class="p-3 bg-slate-800 rounded-lg border border-slate-700">
                            <h3 class="text-xs font-bold text-gray-400 uppercase mb-2">Knowledge Base</h3>
                            <ul class="space-y-2 text-xs text-gray-300">
                                <li class="flex items-center gap-2"><span class="text-green-400">‚úì</span> Hardware Grounding</li>
                                <li class="flex items-center gap-2"><span class="text-green-400">‚úì</span> 2026 GPU Specs</li>
                                <li class="flex items-center gap-2"><span class="text-green-400">‚úì</span> FinOps Best Practices</li>
                            </ul>
                        </div>

                        <div class="p-3 bg-slate-800/50 rounded-lg border border-slate-700">
                            <div class="flex items-center justify-between mb-2">
                                <h3 class="text-xs font-bold text-gray-400 uppercase">Daily Quota</h3>
                                <span class="text-xs text-gray-500">üïê</span>
                            </div>
                            <div class="flex items-baseline gap-1">
                                <span id="remainingQuota" class="text-2xl font-bold text-green-400">7</span>
                                <span class="text-xs text-gray-500">/ 7 left today</span>
                            </div>
                        </div>

                        <div class="p-3 bg-purple-900/20 rounded-lg border border-purple-500/20">
                            <h3 class="text-xs font-bold text-purple-400 uppercase mb-2">Pro Features</h3>
                            <p class="text-[10px] text-gray-400 leading-relaxed mb-3">
                                Unlimited consultations, custom reports, and priority support.
                            </p>
                            <a href="https://github.com/hongping-zh/ecocompute-ai" 
                               class="block w-full py-1.5 bg-purple-600 hover:bg-purple-500 text-white text-xs font-bold rounded text-center transition">
                                Learn More
                            </a>
                        </div>
                    </div>
                </div>

                <div class="text-[10px] text-gray-600 text-center">
                    Powered by EcoCompute AI
                </div>
            </div>

            <!-- Chat Area -->
            <div class="flex-1 flex flex-col bg-slate-900">
                <!-- Header -->
                <div class="h-16 border-b border-slate-700 flex items-center justify-between px-6 bg-slate-950/50">
                    <div>
                        <h3 class="text-white font-bold flex items-center gap-2">
                            AI FinOps Advisor
                            <span class="bg-green-500 text-black text-[10px] px-1.5 py-0.5 rounded font-bold">LIVE</span>
                        </h3>
                        <p class="text-xs text-gray-500">Expert guidance on AI cost optimization</p>
                    </div>
                    <button onclick="closeAdvisorChat()" class="p-2 hover:bg-slate-800 rounded-full text-gray-400 transition">
                        <span class="text-xl">&times;</span>
                    </button>
                </div>

                <!-- Messages -->
                <div id="chatMessages" class="flex-1 overflow-y-auto p-6 space-y-4">
                    <!-- Welcome message -->
                    <div class="flex gap-3">
                        <div class="w-8 h-8 rounded-full bg-purple-500/20 flex items-center justify-center shrink-0 border border-purple-500/30">
                            <span>ü§ñ</span>
                        </div>
                        <div class="max-w-[80%] rounded-2xl rounded-tl-none p-4 bg-slate-800 text-gray-200 border border-slate-700 text-sm">
                            <p>Welcome to the AI FinOps Advisor! I can help you with:</p>
                            <ul class="mt-2 space-y-1 text-gray-400">
                                <li>‚Ä¢ Cost optimization strategies</li>
                                <li>‚Ä¢ Architecture best practices</li>
                                <li>‚Ä¢ Carbon footprint reduction</li>
                                <li>‚Ä¢ Hardware selection guidance</li>
                            </ul>
                            <p class="mt-2">What would you like to know?</p>
                        </div>
                    </div>
                </div>

                <!-- Input -->
                <div class="p-4 border-t border-slate-700 bg-slate-950">
                    <div class="relative flex items-center gap-2 bg-slate-800 border border-slate-600 rounded-xl p-2 focus-within:border-purple-500 transition">
                        <input 
                            type="text" 
                            id="advisorInput"
                            placeholder="Ask about cost optimization, architecture, ROI..."
                            class="flex-1 bg-transparent text-sm text-white px-3 focus:outline-none"
                            onkeydown="if(event.key === 'Enter') sendAdvisorMessage()"
                        />
                        <button 
                            onclick="sendAdvisorMessage()"
                            class="p-2 bg-purple-600 hover:bg-purple-500 text-white rounded-lg transition"
                        >
                            <span>‚û§</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Citation Modal -->
    <div id="citeModal" class="fixed inset-0 bg-black/70 hidden items-center justify-center z-50 p-4">
        <div class="bg-slate-800 rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b border-slate-700 flex justify-between items-center">
                <h3 class="text-xl font-bold text-green-400">üìö Cite EcoCompute AI</h3>
                <button onclick="closeCiteModal()" class="text-gray-400 hover:text-white text-2xl">&times;</button>
            </div>
            <div class="p-6 space-y-6">
                <!-- BibTeX -->
                <div>
                    <div class="flex justify-between items-center mb-2">
                        <label class="text-sm font-semibold text-gray-300">BibTeX</label>
                        <button onclick="copyToClipboard('bibtex')" class="text-xs bg-green-600 hover:bg-green-500 px-3 py-1 rounded text-white">
                            Copy
                        </button>
                    </div>
                    <pre id="bibtex" class="bg-slate-900 p-4 rounded-lg text-sm text-gray-300 overflow-x-auto">@software{zhang2026ecocompute,
  author = {Zhang, Hongping},
  title = {EcoCompute AI: Pre-Merge Cost Prediction and Carbon Tracking for AI Training},
  year = {2026},
  url = {https://github.com/hongping-zh/ecocompute-ai},
  version = {1.0.0}
}</pre>
                </div>

                <!-- APA -->
                <div>
                    <div class="flex justify-between items-center mb-2">
                        <label class="text-sm font-semibold text-gray-300">APA</label>
                        <button onclick="copyToClipboard('apa')" class="text-xs bg-green-600 hover:bg-green-500 px-3 py-1 rounded text-white">
                            Copy
                        </button>
                    </div>
                    <div id="apa" class="bg-slate-900 p-4 rounded-lg text-sm text-gray-300">
                        Zhang, H. (2026). <em>EcoCompute AI: Pre-Merge Cost Prediction and Carbon Tracking for AI Training</em> (Version 1.0.0) [Computer software]. https://github.com/hongping-zh/ecocompute-ai
                    </div>
                </div>

                <!-- Chicago -->
                <div>
                    <div class="flex justify-between items-center mb-2">
                        <label class="text-sm font-semibold text-gray-300">Chicago</label>
                        <button onclick="copyToClipboard('chicago')" class="text-xs bg-green-600 hover:bg-green-500 px-3 py-1 rounded text-white">
                            Copy
                        </button>
                    </div>
                    <div id="chicago" class="bg-slate-900 p-4 rounded-lg text-sm text-gray-300">
                        Zhang, Hongping. "EcoCompute AI: Pre-Merge Cost Prediction and Carbon Tracking for AI Training." Version 1.0.0. 2026. https://github.com/hongping-zh/ecocompute-ai.
                    </div>
                </div>

                <!-- ORCID -->
                <div class="text-center pt-4 border-t border-slate-700">
                    <p class="text-sm text-gray-400">
                        Author ORCID: <a href="https://orcid.org/0009-0000-2529-4613" target="_blank" class="text-green-400 hover:underline">0009-0000-2529-4613</a>
                    </p>
                    <p class="text-sm text-gray-500 mt-2">
                        <a href="https://github.com/hongping-zh/ecocompute-ai/blob/main/paper/EcoCompute_AI_Technical_Report.pdf" target="_blank" class="text-green-400 hover:underline">
                            üìÑ Download Technical Report (PDF)
                        </a>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="py-8 px-4 mt-12 border-t border-slate-700">
        <div class="max-w-4xl mx-auto text-center text-gray-500 text-sm">
            <p>Built with üíö for a sustainable AI future</p>
            <p class="mt-2">
                <a href="https://github.com/hongping-zh/ecocompute-ai" class="hover:text-green-400">GitHub</a> ¬∑ 
                <a href="https://ecocompute-ai-l7e41qn4gf.edgeone.dev/" class="hover:text-green-400">Live Demo</a> ¬∑ 
                <a href="../HARDWARE_GROUNDING.md" class="hover:text-green-400">Technical Docs</a>
            </p>
        </div>
    </footer>

    <script>
        // GPU specifications
        const GPU_SPECS = {
            'h100': { cost: 3.50, tflops: 1979, tdp: 700, efficiency: 1.0 },
            'a100': { cost: 2.50, tflops: 312, tdp: 400, efficiency: 0.85 },
            'v100': { cost: 1.50, tflops: 125, tdp: 300, efficiency: 0.65 },
            't4': { cost: 0.50, tflops: 65, tdp: 70, efficiency: 0.40 },
            'l4': { cost: 0.80, tflops: 121, tdp: 72, efficiency: 0.55 }
        };

        // Model FLOPs per token (approximate)
        const MODEL_FLOPS = {
            'transformer-small': 250e6,
            'transformer-medium': 700e6,
            'transformer-large': 2.6e9,
            'transformer-xl': 13.4e9,
            'llama-7b': 14e9,
            'llama-13b': 26e9,
            'llama-70b': 140e9,
            'resnet-50': 4e9,  // per image, assume 1M images
            'resnet-152': 11e9,
            'bert-base': 22e9,
            'bert-large': 72e9
        };

        // Carbon intensity by region (gCO2/kWh)
        const CARBON_INTENSITY = {
            'us-west': 350,
            'us-east': 400,
            'eu-west': 300,
            'eu-north': 20,
            'asia-east': 550
        };

        // Optimization tips
        const TIPS = [
            "Using mixed precision (FP16/BF16) could reduce training time by 30-50%.",
            "Consider gradient checkpointing to reduce memory usage by 60%.",
            "Training in EU North (Sweden) could reduce carbon by 95% vs Asia East.",
            "Spot instances could save 60-90% on cloud costs.",
            "FlashAttention can speed up transformer training by 2-4x.",
            "Consider using a smaller model first to validate your approach."
        ];

        function calculate() {
            const modelType = document.getElementById('modelType').value;
            const gpuType = document.getElementById('gpuType').value;
            const numGpus = parseInt(document.getElementById('numGpus').value);
            const tokens = parseInt(document.getElementById('tokens').value) * 1e9;
            const region = document.getElementById('region').value;

            const gpu = GPU_SPECS[gpuType];
            const flopsPerToken = MODEL_FLOPS[modelType];

            // Calculate total FLOPs (forward + backward ‚âà 6x per token for training)
            const totalFlops = flopsPerToken * tokens * 6;

            // Calculate time (accounting for efficiency)
            const effectiveTflops = gpu.tflops * gpu.efficiency * numGpus * 1e12;
            const timeSeconds = totalFlops / effectiveTflops;
            const timeHours = timeSeconds / 3600;

            // Calculate cost
            const cost = timeHours * numGpus * gpu.cost;

            // Calculate carbon
            const energyKwh = timeHours * gpu.tdp * numGpus / 1000;
            const carbonKg = energyKwh * CARBON_INTENSITY[region] / 1000;
            const kmDriven = carbonKg * 6.5;

            // Update UI
            document.getElementById('numGpusValue').textContent = numGpus;
            document.getElementById('tokensValue').textContent = formatTokens(tokens);

            document.getElementById('costResult').textContent = formatCost(cost);
            document.getElementById('costBreakdown').textContent = 
                `${timeHours.toFixed(1)} hrs √ó ${numGpus} GPUs √ó $${gpu.cost}/hr`;

            document.getElementById('timeResult').textContent = formatTime(timeHours);
            document.getElementById('timeBreakdown').textContent = 
                timeHours > 24 ? `~${(timeHours/24).toFixed(1)} days` : `~${timeHours.toFixed(1)} hours`;

            document.getElementById('carbonResult').textContent = formatCarbon(carbonKg);
            document.getElementById('carbonBreakdown').textContent = 
                `‚âà ${formatNumber(kmDriven)} km driven`;

            // Random tip
            document.getElementById('optimizationTip').textContent = 
                TIPS[Math.floor(Math.random() * TIPS.length)];
        }

        function formatCost(cost) {
            if (cost >= 1e6) return `$${(cost/1e6).toFixed(2)}M`;
            if (cost >= 1e3) return `$${(cost/1e3).toFixed(1)}K`;
            return `$${cost.toFixed(0)}`;
        }

        function formatTime(hours) {
            if (hours >= 24 * 30) return `${(hours/24/30).toFixed(1)} months`;
            if (hours >= 24) return `${(hours/24).toFixed(1)} days`;
            return `${hours.toFixed(1)} hours`;
        }

        function formatCarbon(kg) {
            if (kg >= 1000) return `${(kg/1000).toFixed(1)} tonnes CO‚ÇÇe`;
            return `${kg.toFixed(0)} kg CO‚ÇÇe`;
        }

        function formatTokens(tokens) {
            if (tokens >= 1e12) return `${(tokens/1e12).toFixed(1)}T`;
            if (tokens >= 1e9) return `${(tokens/1e9).toFixed(0)}B`;
            return `${(tokens/1e6).toFixed(0)}M`;
        }

        function formatNumber(num) {
            return num.toLocaleString('en-US', { maximumFractionDigits: 0 });
        }

        // Event listeners
        document.getElementById('modelType').addEventListener('change', calculate);
        document.getElementById('gpuType').addEventListener('change', calculate);
        document.getElementById('numGpus').addEventListener('input', calculate);
        document.getElementById('tokens').addEventListener('input', calculate);
        document.getElementById('region').addEventListener('change', calculate);

        // Initial calculation
        calculate();

        // Citation Modal Functions
        function openCiteModal() {
            const modal = document.getElementById('citeModal');
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        function closeCiteModal() {
            const modal = document.getElementById('citeModal');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        }

        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            const text = element.innerText || element.textContent;
            navigator.clipboard.writeText(text).then(() => {
                // Show feedback
                const btn = event.target;
                const originalText = btn.textContent;
                btn.textContent = 'Copied!';
                btn.classList.add('bg-green-500');
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.classList.remove('bg-green-500');
                }, 1500);
            });
        }

        // Close modal on outside click
        document.getElementById('citeModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeCiteModal();
            }
        });

        // Close modal on Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeCiteModal();
                closeAdvisorChat();
            }
        });

        // ========== AI FinOps Advisor Functions ==========
        
        const ADVISOR_RESPONSES = {
            'roi': `**Cost Optimization Strategies**

Here are the top ways to reduce your AI training costs:

1. **Use Mixed Precision (FP16/BF16)**
   - Reduces memory by 50%
   - Speeds up training by 30-50%
   - Minimal accuracy loss (<0.1%)

2. **Optimize Batch Size**
   - Larger batches = better GPU utilization
   - Use gradient accumulation if memory-limited

3. **Choose the Right GPU**
   - H100: Best for large models (>7B params)
   - A100: Sweet spot for most workloads
   - T4/L4: Great for inference and fine-tuning

4. **Use Spot/Preemptible Instances**
   - 60-90% cost savings
   - Good for fault-tolerant training

5. **Regional Arbitrage**
   - US-East vs EU-North can differ by 20%
   - Consider carbon intensity too!

**Typical Savings: 30-50% reduction in cloud costs**`,

            'architecture': `**Architecture Best Practices**

For efficient AI training, follow these guidelines:

**1. Model Architecture**
- Use FlashAttention-2 for transformers (2-4x speedup)
- Consider MoE (Mixture of Experts) for large models
- Implement gradient checkpointing for memory savings

**2. Data Pipeline**
- Prefetch data to avoid GPU idle time
- Use WebDataset or similar for distributed training
- Tokenize offline, not during training

**3. Distributed Training**
- FSDP > DDP for large models
- Use tensor parallelism for >13B models
- Pipeline parallelism for extreme scale

**4. Hardware Selection**
| Model Size | Recommended GPU | Why |
|------------|-----------------|-----|
| <1B | A100 40GB | Cost-effective |
| 1-7B | A100 80GB | Memory headroom |
| 7-70B | H100 SXM | NVLink bandwidth |
| >70B | H100 cluster | Multi-node required |

**5. Monitoring**
- Track GPU utilization (target >90%)
- Monitor memory bandwidth usage
- Set up cost alerts`,

            'carbon': `**Carbon Footprint Reduction**

Reduce your AI's environmental impact:

**1. Choose Green Regions**
| Region | Carbon Intensity | Savings vs US-East |
|--------|------------------|-------------------|
| EU North (Sweden) | 20 gCO‚ÇÇ/kWh | -95% |
| EU West | 300 gCO‚ÇÇ/kWh | -25% |
| US West | 350 gCO‚ÇÇ/kWh | -12% |
| US East | 400 gCO‚ÇÇ/kWh | baseline |
| Asia East | 550 gCO‚ÇÇ/kWh | +37% |

**2. Optimize Efficiency**
- Every 1% efficiency gain = 1% carbon reduction
- Use the techniques from cost optimization

**3. Schedule Wisely**
- Train during low-carbon hours (night in most regions)
- Use carbon-aware schedulers

**4. Right-size Your Training**
- Do you really need 2T tokens?
- Consider curriculum learning
- Early stopping saves energy

**5. Offset Responsibly**
- Calculate your footprint first
- Use verified carbon credits
- Invest in renewable energy

**Impact**: Training in Sweden vs China can reduce carbon by **95%**`,

            'default': `Great question! Let me help you with that.

**EcoCompute AI** helps you optimize AI training in three ways:

1. **Cost Prediction** ‚Äî Know your costs before training
2. **Carbon Tracking** ‚Äî Measure environmental impact
3. **Optimization Tips** ‚Äî Actionable recommendations

**Key Features:**
- MLPerf-calibrated predictions (<5% error)
- Support for H100, A100, V100, T4, L4
- Regional carbon intensity data
- CI/CD integration via GitHub Action

Would you like to know more about:
- üí∞ Cost optimization strategies
- üèóÔ∏è Architecture best practices
- üå± Carbon reduction tips

Just ask!`
        };

        let advisorQuota = 7;
        const QUOTA_KEY = 'advisor_quota';
        const QUOTA_DATE_KEY = 'advisor_quota_date';

        function initQuota() {
            const today = new Date().toISOString().split('T')[0];
            const storedDate = localStorage.getItem(QUOTA_DATE_KEY);
            
            if (storedDate !== today) {
                localStorage.setItem(QUOTA_DATE_KEY, today);
                localStorage.setItem(QUOTA_KEY, '7');
                advisorQuota = 7;
            } else {
                advisorQuota = parseInt(localStorage.getItem(QUOTA_KEY) || '7');
            }
            updateQuotaDisplay();
        }

        function updateQuotaDisplay() {
            const quotaEl = document.getElementById('remainingQuota');
            if (quotaEl) {
                quotaEl.textContent = advisorQuota;
                quotaEl.className = advisorQuota > 0 
                    ? 'text-2xl font-bold text-green-400' 
                    : 'text-2xl font-bold text-red-400';
            }
        }

        function decrementQuota() {
            if (advisorQuota > 0) {
                advisorQuota--;
                localStorage.setItem(QUOTA_KEY, advisorQuota.toString());
                updateQuotaDisplay();
            }
        }

        function openAdvisorChat() {
            initQuota();
            const modal = document.getElementById('advisorModal');
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            document.getElementById('advisorInput').focus();
        }

        function closeAdvisorChat() {
            const modal = document.getElementById('advisorModal');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        }

        function askQuickQuestion(topic) {
            openAdvisorChat();
            setTimeout(() => {
                const input = document.getElementById('advisorInput');
                const questions = {
                    'roi': 'How can I reduce my AI training costs?',
                    'architecture': 'What are the best practices for AI architecture?',
                    'carbon': 'How can I reduce my carbon footprint?'
                };
                input.value = questions[topic] || '';
                sendAdvisorMessage();
            }, 300);
        }

        function getAdvisorResponse(message) {
            const lowerMsg = message.toLowerCase();
            
            if (lowerMsg.includes('cost') || lowerMsg.includes('save') || lowerMsg.includes('money') || 
                lowerMsg.includes('reduce') || lowerMsg.includes('roi') || lowerMsg.includes('‰ª∑') || lowerMsg.includes('ÁúÅ')) {
                return ADVISOR_RESPONSES['roi'];
            }
            if (lowerMsg.includes('architect') || lowerMsg.includes('best practice') || 
                lowerMsg.includes('design') || lowerMsg.includes('structure') || lowerMsg.includes('Êû∂ÊûÑ')) {
                return ADVISOR_RESPONSES['architecture'];
            }
            if (lowerMsg.includes('carbon') || lowerMsg.includes('green') || lowerMsg.includes('environment') || 
                lowerMsg.includes('co2') || lowerMsg.includes('emission') || lowerMsg.includes('Á¢≥')) {
                return ADVISOR_RESPONSES['carbon'];
            }
            return ADVISOR_RESPONSES['default'];
        }

        async function sendAdvisorMessage() {
            const input = document.getElementById('advisorInput');
            const message = input.value.trim();
            if (!message) return;

            if (advisorQuota <= 0) {
                addChatMessage('model', "You've reached your daily limit of 7 free consultations. Please come back tomorrow or upgrade to Pro for unlimited access.");
                return;
            }

            // Add user message
            addChatMessage('user', message);
            input.value = '';
            decrementQuota();

            // Show typing indicator
            const typingId = addTypingIndicator();

            // Simulate response delay
            await new Promise(resolve => setTimeout(resolve, 800));

            // Remove typing indicator
            removeTypingIndicator(typingId);

            // Get and display response with streaming effect
            const response = getAdvisorResponse(message);
            await streamResponse(response);
        }

        function addChatMessage(role, text) {
            const container = document.getElementById('chatMessages');
            const msgDiv = document.createElement('div');
            msgDiv.className = `flex gap-3 ${role === 'user' ? 'justify-end' : 'justify-start'}`;
            
            if (role === 'model') {
                msgDiv.innerHTML = `
                    <div class="w-8 h-8 rounded-full bg-purple-500/20 flex items-center justify-center shrink-0 border border-purple-500/30">
                        <span>ü§ñ</span>
                    </div>
                    <div class="max-w-[80%] rounded-2xl rounded-tl-none p-4 bg-slate-800 text-gray-200 border border-slate-700 text-sm whitespace-pre-wrap">${text}</div>
                `;
            } else {
                msgDiv.innerHTML = `
                    <div class="max-w-[80%] rounded-2xl rounded-tr-none p-4 bg-purple-600 text-white text-sm">${text}</div>
                    <div class="w-8 h-8 rounded-full bg-slate-700 flex items-center justify-center shrink-0">
                        <span>üë§</span>
                    </div>
                `;
            }
            
            container.appendChild(msgDiv);
            container.scrollTop = container.scrollHeight;
            return msgDiv;
        }

        function addTypingIndicator() {
            const container = document.getElementById('chatMessages');
            const typingDiv = document.createElement('div');
            typingDiv.id = 'typingIndicator';
            typingDiv.className = 'flex gap-3';
            typingDiv.innerHTML = `
                <div class="w-8 h-8 rounded-full bg-purple-500/20 flex items-center justify-center shrink-0 border border-purple-500/30">
                    <span>ü§ñ</span>
                </div>
                <div class="flex items-center gap-1 bg-slate-800 px-4 py-3 rounded-2xl rounded-tl-none border border-slate-700">
                    <div class="w-2 h-2 bg-gray-500 rounded-full animate-bounce" style="animation-delay: 0ms"></div>
                    <div class="w-2 h-2 bg-gray-500 rounded-full animate-bounce" style="animation-delay: 150ms"></div>
                    <div class="w-2 h-2 bg-gray-500 rounded-full animate-bounce" style="animation-delay: 300ms"></div>
                </div>
            `;
            container.appendChild(typingDiv);
            container.scrollTop = container.scrollHeight;
            return 'typingIndicator';
        }

        function removeTypingIndicator(id) {
            const el = document.getElementById(id);
            if (el) el.remove();
        }

        async function streamResponse(text) {
            const container = document.getElementById('chatMessages');
            const msgDiv = document.createElement('div');
            msgDiv.className = 'flex gap-3';
            msgDiv.innerHTML = `
                <div class="w-8 h-8 rounded-full bg-purple-500/20 flex items-center justify-center shrink-0 border border-purple-500/30">
                    <span>ü§ñ</span>
                </div>
                <div id="streamingText" class="max-w-[80%] rounded-2xl rounded-tl-none p-4 bg-slate-800 text-gray-200 border border-slate-700 text-sm whitespace-pre-wrap"></div>
            `;
            container.appendChild(msgDiv);

            const textEl = document.getElementById('streamingText');
            const words = text.split(' ');
            let accumulated = '';

            for (let i = 0; i < words.length; i++) {
                accumulated += (i === 0 ? '' : ' ') + words[i];
                textEl.innerHTML = accumulated;
                container.scrollTop = container.scrollHeight;
                await new Promise(resolve => setTimeout(resolve, 15));
            }

            textEl.removeAttribute('id');
        }

        // Close advisor modal on outside click
        document.getElementById('advisorModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeAdvisorChat();
            }
        });

        // Initialize quota on page load
        initQuota();
    </script>
</body>
</html>
